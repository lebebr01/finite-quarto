<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brandon LeBeau">
<meta name="dcterms.date" content="2025-11-06">

<title>simglm v0.9.26: Multi-level Propensity Score Modeling â€“ Brandon LeBeau</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//images/bl_favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-55373f81aad687d9e5c9f061504c548c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-95bd368a27abdcadd26b2436c52b31a5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-14CK5K9RD6"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-14CK5K9RD6', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="simglm v0.9.26: Multi-level Propensity Score Modeling â€“ Brandon LeBeau">
<meta property="og:description" content="Academic website and blog">
<meta property="og:image" content="https://brandonlebeau.org/posts/2025-11-06-simglm-multilevel-propensity_files/figure-html/unnamed-chunk-5-1.png">
<meta property="og:site_name" content="Brandon LeBeau">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Brandon LeBeau</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../posts/"> 
<span class="menu-text">Educate-R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications/"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../presentations/"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../packages/"> 
<span class="menu-text">R Packages</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../workshops/"> 
<span class="menu-text">Workshops</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about/"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"></a>
  <ul class="collapse">
  <li><a href="#new-features-at-a-glance" id="toc-new-features-at-a-glance" class="nav-link" data-scroll-target="#new-features-at-a-glance">ðŸ†• New Features at a Glance</a></li>
  <li><a href="#multi-level-propensity-score-modeling-example" id="toc-multi-level-propensity-score-modeling-example" class="nav-link" data-scroll-target="#multi-level-propensity-score-modeling-example">Multi-level Propensity Score Modeling Example</a>
  <ul class="collapse">
  <li><a href="#specifying-treatment-at-different-levels" id="toc-specifying-treatment-at-different-levels" class="nav-link" data-scroll-target="#specifying-treatment-at-different-levels">Specifying treatment at different levels</a></li>
  <li><a href="#visualization-example" id="toc-visualization-example" class="nav-link" data-scroll-target="#visualization-example">Visualization Example</a></li>
  <li><a href="#treatment-assignment-at-level-3" id="toc-treatment-assignment-at-level-3" class="nav-link" data-scroll-target="#treatment-assignment-at-level-3">Treatment assignment at level 3</a></li>
  </ul></li>
  <li><a href="#flexible-model-specification" id="toc-flexible-model-specification" class="nav-link" data-scroll-target="#flexible-model-specification">Flexible Model Specification</a>
  <ul class="collapse">
  <li><a href="#bayesian-model-fitting-with-brms" id="toc-bayesian-model-fitting-with-brms" class="nav-link" data-scroll-target="#bayesian-model-fitting-with-brms">Bayesian Model Fitting with <code>brms</code></a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">simglm v0.9.26: Multi-level Propensity Score Modeling</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">simglm</div>
    <div class="quarto-category">modeling</div>
    <div class="quarto-category">propensity scores</div>
  </div>
  </div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brandon LeBeau </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 6, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="section" class="level1">
<h1></h1>
<p>This update marks the final propensity score enhancement for the <code>simglm</code> package (v0.9.26). It introduces multi-level propensity score modeling, enabling users to simulate data with nested structures and treatment effects that vary across levels.</p>
<p>Propensity score methods often assume independence between units, but in real-world settings, data are hierarchical (e.g., students nested in classrooms, patients nested in hospitals). This release bridges that gapâ€”allowing for <em>realistic multi-level causal inference simulation.</em></p>
<section id="new-features-at-a-glance" class="level3">
<h3 class="anchored" data-anchor-id="new-features-at-a-glance">ðŸ†• New Features at a Glance</h3>
<ul>
<li><strong>Hierarchical data simulation</strong> â€” Generate nested structures (e.g., students within schools, hospitals within regions).<br>
</li>
<li><strong>Multi-level propensity modeling</strong> â€” The <code>propensity_model</code> argument now supports random effects and hierarchical assignment.<br>
</li>
<li><strong>Cross-level treatment effects</strong> â€” Specify treatments applied at any level (e.g., classrooms, schools, or districts).<br>
</li>
<li><strong>Custom model fitting functions</strong> â€” Pass your own model-fitting function (<code>glm</code>, <code>lme4::glmer</code>, or even <code>brms::brm</code>) with additional arguments.</li>
</ul>
<p>If you havenâ€™t already, remember to first install the latest release of the <code>simglm</code> package from GitHub.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'lebebr01/simglm'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="multi-level-propensity-score-modeling-example" class="level2">
<h2 class="anchored" data-anchor-id="multi-level-propensity-score-modeling-example">Multi-level Propensity Score Modeling Example</h2>
<p>First, letâ€™s show the new features that allow the user to specify a multi-level propensity score model. In this example, we will simulate data with students nested within classrooms, where the treatment assignment is still being specified at the student level. The model formula specified for both the full data generation and propensity model specification use <code>lme4</code> style syntax. Any data features generated during the propensity score model simulation carry over to the final data generation step.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simglm)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>level1_samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>sim_arguments <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> <span class="fu">list</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">motivation =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">50</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity =</span> <span class="fu">list</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'ordinal'</span>, </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="sc">-</span><span class="dv">7</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ses =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>, </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>, </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">50</span>),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_type =</span> <span class="st">'binary'</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_fixed</span>(<span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_error</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_randomeffect</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate_response</span>(sim_arguments) <span class="sc">|&gt;</span> </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  X.Intercept. motivation trt age      ses level1_id classroom      error
1            1   6.502731   1  -4 1.026945         1         1 -0.9554712
2            1   4.548620   1   2 1.026945         2         1 -5.7521228
3            1  11.132905   0  -2 1.026945         3         1  3.8836490
4            1  -3.523738   0   2 1.026945         4         1  1.6403897
5            1  41.977955   0  -3 1.026945         5         1 -2.5984848
6            1  -8.826909   0  -6 1.026945         6         1 -0.0853880
  int_classroom fixed_outcome random_effects achievement
1     -1.405126      53.65783      -1.405126    51.29723
2     -1.405126      53.47618      -1.405126    46.31894
3     -1.405126      54.50990      -1.405126    56.98842
4     -1.405126      49.04724      -1.405126    49.28251
5     -1.405126      66.74792      -1.405126    62.74431
6     -1.405126      46.12597      -1.405126    44.63546</code></pre>
</div>
</div>
<section id="specifying-treatment-at-different-levels" class="level3">
<h3 class="anchored" data-anchor-id="specifying-treatment-at-different-levels">Specifying treatment at different levels</h3>
<p>In addition to specifying treatment at level 1 (e.g., students), users can now specify treatment assignment at higher levels (e.g., classrooms). Below is an example where treatment is assigned at level 2 (classrooms). The <code>simglm</code> package does this by computing the average value for each cluster (classrooms here) and then uses that value to assign the treatment to that cluster. To specify this treatment assignment, the user simply needs to set the <code>outcome_level</code> argument within the <code>propensity</code> list to the desired level (2 in this case).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>level1_samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">size =</span> <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sim_arguments <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> <span class="fu">list</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">motivation =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">50</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity =</span> <span class="fu">list</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'ordinal'</span>, </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="sc">-</span><span class="dv">7</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ses =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>, </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>, </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">50</span>),</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>),</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_type =</span> <span class="st">'binary'</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_level =</span> <span class="dv">2</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_fixed</span>(<span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_error</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_randomeffect</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate_response</span>(sim_arguments)<span class="sc">|&gt;</span> </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  X.Intercept. motivation trt age       ses level1_id classroom      error
1            1  23.948833   1   2 -1.499993         1         1 -3.4630538
2            1   3.517415   1   5 -1.499993         2         1  1.0019384
3            1 -12.423001   1   4 -1.499993         3         1  0.4293656
4            1 -23.844401   1  -6 -1.499993         4         1 -0.9232922
5            1 -44.794205   1   3 -1.499993         5         1  1.9578812
6            1  14.122256   1  -5 -1.499993         6         1 -2.1116858
  int_classroom fixed_outcome random_effects achievement
1      5.951099      60.60453       5.951099    63.09258
2      5.951099      52.73197       5.951099    59.68500
3      5.951099      46.25580       5.951099    52.63627
4      5.951099      40.68724       5.951099    45.71505
5      5.951099      33.20732       5.951099    41.11630
6      5.951099      55.97390       5.951099    59.81332</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ðŸ’¡ <em>Tip:</em> When treatment is assigned at a higher level, all units within that cluster receive the same treatment indicator. This makes simulation results especially useful for cluster-randomized trial designs.</p>
</blockquote>
</section>
<section id="visualization-example" class="level3">
<h3 class="anchored" data-anchor-id="visualization-example">Visualization Example</h3>
<p>Hereâ€™s a quick example of how you might visualize simulated treatment variation across classrooms:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">simulate_fixed</span>(<span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_error</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_randomeffect</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate_response</span>(sim_arguments)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(classroom), <span class="at">y =</span> trt)) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Classroom ID"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Treatment Assignment (0 = Control, 1 = Treatment)"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cluster-Level Treatment Variation"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025-11-06-simglm-multilevel-propensity_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="three-level-example" class="level4">
<h4 class="anchored" data-anchor-id="three-level-example">Three-level Example</h4>
<p>Here is an example where there are now classrooms and districts being specified. The treatment assignment is still being specified at the classroom level with <code>outcome_level = 2</code>, but there is now another level to be considered.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>level1_samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">size =</span> <span class="dv">150</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>sim_arguments <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> district),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> <span class="fu">list</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">motivation =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">10</span>, <span class="at">level3 =</span> <span class="dv">15</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">int_district =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">2</span>, <span class="at">var_level =</span> <span class="dv">3</span>)),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity =</span> <span class="fu">list</span>(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> district),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'ordinal'</span>, </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="sc">-</span><span class="dv">7</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ses =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>, </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">sample_size =</span>  <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">10</span>, <span class="at">level3 =</span> <span class="dv">15</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">int_district =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">2</span>, <span class="at">var_level =</span> <span class="dv">3</span>)),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_type =</span> <span class="st">'binary'</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_level =</span> <span class="dv">2</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_fixed</span>(<span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_error</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_randomeffect</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate_response</span>(sim_arguments) <span class="sc">|&gt;</span> </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
New names:
â€¢ `X.Intercept.` -&gt; `X.Intercept....1`
â€¢ `X.Intercept.` -&gt; `X.Intercept....2`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  X.Intercept. motivation trt age       ses level1_id classroom district
1            1 -54.488721   1  -1 -5.700812         1         1        1
2            1  -5.005362   1  -1 -5.700812         2         1        1
3            1  37.278043   1  -2 -5.700812         3         1        1
4            1 -20.904998   1   5 -5.700812         4         1        1
5            1  12.779405   1  -7 -5.700812         5         1        1
6            1   4.861477   1  -7 -5.700812         6         1        1
      error int_classroom int_district fixed_outcome random_effects achievement
1 -7.056390      1.836647    0.2612293      27.87931       2.097876    22.92079
2 -4.276418      1.836647    0.2612293      47.67265       2.097876    45.49411
3  4.207792      1.836647    0.2612293      64.48601       2.097876    70.79168
4  3.465661      1.836647    0.2612293      41.91280       2.097876    47.47634
5  2.112933      1.836647    0.2612293      54.18656       2.097876    58.39737
6 -1.283107      1.836647    0.2612293      51.01939       2.097876    51.83416</code></pre>
</div>
</div>
</section>
</section>
<section id="treatment-assignment-at-level-3" class="level3">
<h3 class="anchored" data-anchor-id="treatment-assignment-at-level-3">Treatment assignment at level 3</h3>
<p>The treatment assignment can alternatively be specified at the district level, by setting <code>outcome_level = 3</code> within the <code>propensity</code> list.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>level1_samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">size =</span> <span class="dv">150</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sim_arguments <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> district),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> <span class="fu">list</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">motivation =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">10</span>, <span class="at">level3 =</span> <span class="dv">15</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">int_district =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">2</span>, <span class="at">var_level =</span> <span class="dv">3</span>)),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity =</span> <span class="fu">list</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> district),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'ordinal'</span>, </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="sc">-</span><span class="dv">7</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ses =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>, </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>, </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">sample_size =</span>  <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">10</span>, <span class="at">level3 =</span> <span class="dv">15</span>),</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">int_district =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">2</span>, <span class="at">var_level =</span> <span class="dv">3</span>)),</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_type =</span> <span class="st">'binary'</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_level =</span> <span class="dv">3</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="fu">simulate_fixed</span>(<span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_error</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">simulate_randomeffect</span>(<span class="at">sim_args =</span> sim_arguments) <span class="sc">|&gt;</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate_response</span>(sim_arguments)<span class="sc">|&gt;</span> </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
New names:
â€¢ `X.Intercept.` -&gt; `X.Intercept....1`
â€¢ `X.Intercept.` -&gt; `X.Intercept....2`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  X.Intercept. motivation trt age      ses level1_id classroom district
1            1  -4.538476   1   7 1.670979         1         1        1
2            1  -9.869254   1   3 1.670979         2         1        1
3            1  -6.006584   1   3 1.670979         3         1        1
4            1  16.765529   1   2 1.670979         4         1        1
5            1  -9.933779   1  -3 1.670979         5         1        1
6            1  34.817235   1   5 1.670979         6         1        1
       error int_classroom int_district fixed_outcome random_effects
1  1.7127887      4.874151     -0.98758      50.50235       3.886571
2 -2.5383693      4.874151     -0.98758      47.97004       3.886571
3  0.3557401      4.874151     -0.98758      49.51511       3.886571
4 -3.2642383      4.874151     -0.98758      58.52396       3.886571
5  1.2402380      4.874151     -0.98758      47.34423       3.886571
6 -5.6804034      4.874151     -0.98758      66.04464       3.886571
  achievement
1    56.10171
2    49.31824
3    53.75742
4    59.14629
5    52.47104
6    64.25081</code></pre>
</div>
</div>
</section>
</section>
<section id="flexible-model-specification" class="level2">
<h2 class="anchored" data-anchor-id="flexible-model-specification">Flexible Model Specification</h2>
<p>The other enhancement is to how the propensity model is fitted and extracted. The internal function for this process has been generalized to allow users to specify whichever model fitting procedure they want. If no model fitting is specified, <code>stats::glm()</code> function is used. If there is a multi-level structure, <code>lme4::glmer()</code> or some alternative, would be more appropriate and would need to be specified within the propensity_model simulation arguments.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>level1_samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">size =</span> <span class="dv">75</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sim_arguments <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> <span class="fu">list</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">motivation =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">75</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity =</span> <span class="fu">list</span>(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'ordinal'</span>, </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="sc">-</span><span class="dv">7</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ses =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>, </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>, </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">sample_size =</span> <span class="fu">list</span>(<span class="at">level1 =</span> level1_samp, <span class="at">level2 =</span> <span class="dv">75</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">randomeffect =</span> <span class="fu">list</span>(<span class="at">int_classroom =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>, <span class="at">var_level =</span> <span class="dv">2</span>)),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.8</span>),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_type =</span> <span class="st">'binary'</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_level =</span> <span class="dv">2</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_fit =</span> <span class="fu">list</span>(<span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">model_function =</span> lme4<span class="sc">::</span>lmer),</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity_model =</span> <span class="fu">list</span>(</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom),</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">propensity_type =</span> <span class="st">'covariate'</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">model_function =</span> lme4<span class="sc">::</span>glmer,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">propensity_model_args =</span> <span class="fu">list</span>(</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">replications =</span> <span class="dv">10</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">extract_coefficients =</span> <span class="cn">TRUE</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="fu">replicate_simulation</span>(sim_arguments)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
Model failed to converge with max|grad| = 0.0556873 (tol = 0.002, component 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, : Model is nearly unidentifiable: very large eigenvalue
 - Rescale variables?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
         term      estimate    std.error statistic
1 (Intercept)  2.908904e+00 7.138991e-01  4.074670
2  motivation  4.056633e-01 4.302511e-03 94.285228
3         trt  2.369709e+04 6.787640e+03  3.491212
4  propensity -2.369950e+04 6.788101e+03 -3.491329

[[2]]
         term      estimate    std.error statistic
1 (Intercept)  1.256255e+00 4.501801e-01  2.790561
2  motivation  3.988186e-01 4.456008e-03 89.501326
3         trt  1.035445e+04 6.851057e+03  1.511366
4  propensity -1.035536e+04 6.851238e+03 -1.511458

[[3]]
         term      estimate    std.error statistic
1 (Intercept)  9.734051e-01 5.325444e-01  1.827838
2  motivation  4.034641e-01 4.247209e-03 94.995117
3         trt  1.522479e+04 9.038478e+03  1.684441
4  propensity -1.522510e+04 9.038724e+03 -1.684430

[[4]]
         term      estimate    std.error statistic
1 (Intercept)     1.2694900 4.291298e-01  2.958289
2  motivation     0.3971322 4.178960e-03 95.031348
3         trt  5118.1511922 3.557972e+03  1.438502
4  propensity -5118.8380437 3.558231e+03 -1.438591

[[5]]
         term      estimate    std.error  statistic
1 (Intercept)     1.4644805 5.567131e-01  2.6305841
2  motivation     0.3982062 4.077144e-03 97.6679352
3         trt  2105.2649994 7.100847e+03  0.2964808
4  propensity -2106.0079375 7.101062e+03 -0.2965765

[[6]]
         term      estimate    std.error statistic
1 (Intercept)     0.8776863 5.054796e-01  1.736343
2  motivation     0.3955913 4.261973e-03 92.818811
3         trt  3796.5598590 2.271809e+03  1.671162
4  propensity -3797.5932828 2.272149e+03 -1.671367

[[7]]
         term      estimate    std.error statistic
1 (Intercept)     1.1598000 4.936926e-01  2.349235
2  motivation     0.4055483 4.287862e-03 94.580542
3         trt  6389.5839804 2.894362e+03  2.207597
4  propensity -6390.3572335 2.894661e+03 -2.207636

[[8]]
         term      estimate    std.error statistic
1 (Intercept)  2.024031e+00 4.310026e-01  4.696100
2  motivation  4.006582e-01 4.150963e-03 96.521753
3         trt  1.704448e+04 6.978264e+03  2.442510
4  propensity -1.704617e+04 6.978520e+03 -2.442663

[[9]]
         term      estimate    std.error statistic
1 (Intercept)  1.001839e+00 5.212012e-01  1.922172
2  motivation  4.024457e-01 4.201464e-03 95.786999
3         trt  1.776691e+04 8.062954e+03  2.203524
4  propensity -1.776733e+04 8.063197e+03 -2.203509

[[10]]
         term      estimate    std.error statistic
1 (Intercept)  2.475772e+00 6.106023e-01  4.054639
2  motivation  4.004046e-01 4.167494e-03 96.078010
3         trt  1.989337e+04 7.453907e+03  2.668851
4  propensity -1.989594e+04 7.454200e+03 -2.669091</code></pre>
</div>
</div>
<section id="bayesian-model-fitting-with-brms" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-model-fitting-with-brms">Bayesian Model Fitting with <code>brms</code></h3>
<p>It is also possible to use different model fitting functions. For example, if you wanted to use a Bayesian logistic regression function, this is now possible with the new model fitting functionality. Iâ€™m going to use the example from the last post with <a href="../posts/2025-10-06-simglm-propensity-modeling.html">single level propensity score models</a> to demonstrate this feature. Here, I will use the <code>brms::brm()</code> function to fit a Bayesian logistic regression model for the propensity score model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sim_arguments <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> <span class="fu">list</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">motivation =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_size =</span> <span class="dv">400</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">10</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">0.4</span>, <span class="fl">1.2</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity =</span> <span class="fu">list</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'ordinal'</span>, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="sc">-</span><span class="dv">7</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ses =</span> <span class="fu">list</span>(<span class="at">var_type =</span> <span class="st">'continuous'</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>)),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">sample_size =</span> <span class="dv">400</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">error =</span> <span class="fu">list</span>(<span class="at">variance =</span> <span class="dv">5</span>),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">reg_weights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.3</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">outcome_type =</span> <span class="st">'binary'</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_fit =</span> <span class="fu">list</span>(<span class="at">formula =</span> achievement <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> motivation <span class="sc">+</span> trt <span class="sc">+</span> age <span class="sc">+</span> ses,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">model_function =</span> <span class="st">'lm'</span>),</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity_model =</span> <span class="fu">list</span>(</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">formula =</span> trt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> ses,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">propensity_type =</span> <span class="st">'sbw'</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">model_function =</span> brms<span class="sc">::</span>brm,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">propensity_model_args =</span> <span class="fu">list</span>(<span class="at">iter =</span> <span class="dv">250</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">bernoulli</span>())</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">replications =</span> <span class="dv">2</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">extract_coefficients =</span> <span class="cn">TRUE</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">replicate_simulation</span>(sim_arguments) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 2.2e-05 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.22 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: WARNING: There aren't enough warmup iterations to fit the
Chain 1:          three stages of adaptation as currently configured.
Chain 1:          Reducing each adaptation stage to 15%/75%/10% of
Chain 1:          the given number of warmup iterations:
Chain 1:            init_buffer = 18
Chain 1:            adapt_window = 95
Chain 1:            term_buffer = 12
Chain 1: 
Chain 1: Iteration:   1 / 250 [  0%]  (Warmup)
Chain 1: Iteration:  25 / 250 [ 10%]  (Warmup)
Chain 1: Iteration:  50 / 250 [ 20%]  (Warmup)
Chain 1: Iteration:  75 / 250 [ 30%]  (Warmup)
Chain 1: Iteration: 100 / 250 [ 40%]  (Warmup)
Chain 1: Iteration: 125 / 250 [ 50%]  (Warmup)
Chain 1: Iteration: 126 / 250 [ 50%]  (Sampling)
Chain 1: Iteration: 150 / 250 [ 60%]  (Sampling)
Chain 1: Iteration: 175 / 250 [ 70%]  (Sampling)
Chain 1: Iteration: 200 / 250 [ 80%]  (Sampling)
Chain 1: Iteration: 225 / 250 [ 90%]  (Sampling)
Chain 1: Iteration: 250 / 250 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 0.004 seconds (Warm-up)
Chain 1:                0.003 seconds (Sampling)
Chain 1:                0.007 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 6e-06 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.06 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: WARNING: There aren't enough warmup iterations to fit the
Chain 2:          three stages of adaptation as currently configured.
Chain 2:          Reducing each adaptation stage to 15%/75%/10% of
Chain 2:          the given number of warmup iterations:
Chain 2:            init_buffer = 18
Chain 2:            adapt_window = 95
Chain 2:            term_buffer = 12
Chain 2: 
Chain 2: Iteration:   1 / 250 [  0%]  (Warmup)
Chain 2: Iteration:  25 / 250 [ 10%]  (Warmup)
Chain 2: Iteration:  50 / 250 [ 20%]  (Warmup)
Chain 2: Iteration:  75 / 250 [ 30%]  (Warmup)
Chain 2: Iteration: 100 / 250 [ 40%]  (Warmup)
Chain 2: Iteration: 125 / 250 [ 50%]  (Warmup)
Chain 2: Iteration: 126 / 250 [ 50%]  (Sampling)
Chain 2: Iteration: 150 / 250 [ 60%]  (Sampling)
Chain 2: Iteration: 175 / 250 [ 70%]  (Sampling)
Chain 2: Iteration: 200 / 250 [ 80%]  (Sampling)
Chain 2: Iteration: 225 / 250 [ 90%]  (Sampling)
Chain 2: Iteration: 250 / 250 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 0.004 seconds (Warm-up)
Chain 2:                0.003 seconds (Sampling)
Chain 2:                0.007 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 1.8e-05 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.18 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: WARNING: There aren't enough warmup iterations to fit the
Chain 1:          three stages of adaptation as currently configured.
Chain 1:          Reducing each adaptation stage to 15%/75%/10% of
Chain 1:          the given number of warmup iterations:
Chain 1:            init_buffer = 18
Chain 1:            adapt_window = 95
Chain 1:            term_buffer = 12
Chain 1: 
Chain 1: Iteration:   1 / 250 [  0%]  (Warmup)
Chain 1: Iteration:  25 / 250 [ 10%]  (Warmup)
Chain 1: Iteration:  50 / 250 [ 20%]  (Warmup)
Chain 1: Iteration:  75 / 250 [ 30%]  (Warmup)
Chain 1: Iteration: 100 / 250 [ 40%]  (Warmup)
Chain 1: Iteration: 125 / 250 [ 50%]  (Warmup)
Chain 1: Iteration: 126 / 250 [ 50%]  (Sampling)
Chain 1: Iteration: 150 / 250 [ 60%]  (Sampling)
Chain 1: Iteration: 175 / 250 [ 70%]  (Sampling)
Chain 1: Iteration: 200 / 250 [ 80%]  (Sampling)
Chain 1: Iteration: 225 / 250 [ 90%]  (Sampling)
Chain 1: Iteration: 250 / 250 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 0.004 seconds (Warm-up)
Chain 1:                0.003 seconds (Sampling)
Chain 1:                0.007 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 5e-06 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.05 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: WARNING: There aren't enough warmup iterations to fit the
Chain 2:          three stages of adaptation as currently configured.
Chain 2:          Reducing each adaptation stage to 15%/75%/10% of
Chain 2:          the given number of warmup iterations:
Chain 2:            init_buffer = 18
Chain 2:            adapt_window = 95
Chain 2:            term_buffer = 12
Chain 2: 
Chain 2: Iteration:   1 / 250 [  0%]  (Warmup)
Chain 2: Iteration:  25 / 250 [ 10%]  (Warmup)
Chain 2: Iteration:  50 / 250 [ 20%]  (Warmup)
Chain 2: Iteration:  75 / 250 [ 30%]  (Warmup)
Chain 2: Iteration: 100 / 250 [ 40%]  (Warmup)
Chain 2: Iteration: 125 / 250 [ 50%]  (Warmup)
Chain 2: Iteration: 126 / 250 [ 50%]  (Sampling)
Chain 2: Iteration: 150 / 250 [ 60%]  (Sampling)
Chain 2: Iteration: 175 / 250 [ 70%]  (Sampling)
Chain 2: Iteration: 200 / 250 [ 80%]  (Sampling)
Chain 2: Iteration: 225 / 250 [ 90%]  (Sampling)
Chain 2: Iteration: 250 / 250 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 0.004 seconds (Warm-up)
Chain 2:                0.004 seconds (Sampling)
Chain 2:                0.008 seconds (Total)
Chain 2: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 5 Ã— 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   50.4     0.405      124.   5.47e-319
2 motivation     0.410   0.00830     49.4  3.16e-171
3 trt            0.542   0.514        1.05 2.92e-  1
4 age            0.152   0.0456       3.33 9.58e-  4
5 ses            0.194   0.0350       5.54 5.39e-  8

[[2]]
# A tibble: 5 Ã— 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   50.6     0.379     133.    0        
2 motivation     0.405   0.00855    47.3   7.05e-165
3 trt            0.288   0.474       0.606 5.45e-  1
4 age            0.109   0.0435      2.52  1.23e-  2
5 ses            0.159   0.0402      3.96  9.02e-  5</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>âš™ï¸ <em>Note:</em> For demonstration purposes, this example uses only 2 replications and 250 iterations across 2 chains. For accurate estimation, these should be increased substantially.</p>
</blockquote>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>These enhancements make <code>simglm</code> a more powerful framework for propensity score simulation, causal inference, and power analysis in multi-level contexts. You can now simulate, estimate, and evaluate designs involving cluster-level assignment, cross-level effects, and complex hierarchical data structuresâ€”all within a single pipeline!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/brandonlebeau\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="social-links">
<p><a href="mailto:brandon-lebeau@uiowa.edu" title="Email"> <i class="fa fa-envelope fa-lg"></i> </a> <a href="https://twitter.com/blebeau11" title="Twitter"> <i class="fa-brands fa-linkedin fa-lg"></i> </a> <a href="https://github.com/lebebr01" title="GitHub"> <i class="fa-brands fa-github fa-lg"></i> </a></p>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Brandon LeBeau</p>
</div>
  </div>
</footer>




</body></html>